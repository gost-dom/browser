# Gost-DOM V8 integration

Some notes specifically for the V8 layer in Gost-DOM.

## Memory Leaks

The current implementation is leaking memory for the scope of a browsing
context. all DOM nodes created and deleted for the lifetime of the context will
stay in memory until navigating, or the browser is actively disposed.

**This is not a problem for the intended use case**. Web scraping SPAs _might_
become a problem.

Actions that will reset the browsing context are:

- Clicking a link (default behaviour not prevented by JavaScript)
- Submitting a form (default behaviour not prevented by JavaScript)
- Refresh or navigating history entries generated by these operations.

Examples that **will not reset** the browsing context are (not necessarily a
complete list):

- Navigating an SPA.
- Navigating an HTML app with boosted links.
- Navigating history entries generated by these types of actions.

### Why memory leaks

This codebase is a marriage between two garbage collected runtimes, and what is
conceptually _one object_ is split into two, a Go object and a JavaScript
wrapper. As long of them is reachable; so must the other be.

I could join them into one; but that would result in an undesired coupling; the
DOM implementation being coupled to the JavaScript execution engine.

Since this project started, weak references has been introduced to Go 1.24 which
I beleve provides a solution to the problem, but this hasn't been prioritised 

For that reason; and because it's not a problem for the intended use case, I
have postponed dealing with that issue.

